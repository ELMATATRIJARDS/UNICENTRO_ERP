<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Unicentro ERP - Control de Personal</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    :root {
      --azul-oscuro: #1e1e2f;
      --azul: #3b82f6;
      --gris-fondo: #f3f4f6;
      --blanco: #ffffff;
      --gris-borde: #e5e7eb;
      --verde: #10b981;
      --rojo: #ef4444;
      --naranja: #f97316;
      --amarillo: #facc15;
    }

    body {
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--gris-fondo);
      color: #111827;
    }

    .sidebar {
      width: 220px;
      background-color: var(--azul-oscuro);
      color: var(--blanco);
      height: 100vh;
      position: fixed;
      top: 0;
      left: 0;
      display: flex;
      flex-direction: column;
      padding-top: 40px;
    }

    .sidebar a {
      color: var(--blanco);
      text-decoration: none;
      padding: 15px 20px;
      font-size: 18px;
      transition: background 0.3s;
    }

    .sidebar a:hover {
      background-color: #2c2c44;
    }

    .main {
      margin-left: 220px;
      padding: 30px;
    }

    h2 {
      font-size: 28px;
      margin-bottom: 20px;
      color: var(--azul-oscuro);
    }

    table {
      width: 100%;
      background-color: var(--blanco);
      border-collapse: collapse;
      border: 1px solid var(--gris-borde);
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.05);
    }

    th, td {
      padding: 12px 15px;
      border-bottom: 1px solid var(--gris-borde);
    }

    th {
      background-color: var(--azul);
      color: var(--blanco);
      text-align: left;
    }

    tr:hover {
      background-color: #f0f9ff;
    }

    /* üîπ Botones de exportaci√≥n */
    .export-buttons {
      margin-bottom: 15px;
      display: flex;
      gap: 10px;
    }

    .export-btn {
      padding: 10px 15px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 15px;
      font-weight: 600;
      color: white;
      transition: transform 0.2s ease, box-shadow 0.3s ease, background 0.3s ease;
    }

    .export-btn img {
      width: 20px;
      height: 20px;
    }

    .csv-btn { background-color: #06b6d4; }
    .csv-btn:hover {
      background-color: #0891b2;
      transform: scale(1.08);
      box-shadow: 0px 4px 12px rgba(6,182,212,0.5);
    }

    .excel-btn { background-color: #22c55e; }
    .excel-btn:hover {
      background-color: #16a34a;
      transform: scale(1.08);
      box-shadow: 0px 4px 12px rgba(34,197,94,0.5);
    }

    .pdf-btn { background-color: #ef4444; }
    .pdf-btn:hover {
      background-color: #dc2626;
      transform: scale(1.08);
      box-shadow: 0px 4px 12px rgba(239,68,68,0.5);
    }

    #controlPersonalForm {
      display: none;
      margin-top: 25px;
      background: var(--blanco);
      padding: 20px;
      width: 350px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
    }

    label {
      font-weight: 600;
      margin-bottom: 5px;
    }

    input {
      padding: 8px;
      font-size: 16px;
      border: 1px solid var(--gris-borde);
      border-radius: 5px;
    }

    #btnRegistrarEmpleado,
    #btnAgregarEmpleado {
      background-color: var(--azul);
      color: white;
      padding: 10px 15px;
      font-size: 16px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      transition: background 0.3s;
    }

    #btnRegistrarEmpleado:hover,
    #btnAgregarEmpleado:hover {
      background-color: #2563eb;
    }

    .accion-btn {
      padding: 6px 12px;
      border: none;
      border-radius: 5px;
      font-size: 14px;
      margin-right: 5px;
      color: white;
      cursor: pointer;
    }

    .editar { background-color: var(--verde); }
    .editar:hover { background-color: #059669; }

    .eliminar { background-color: var(--rojo); }
    .eliminar:hover { background-color: #dc2626; }
  </style>
</head>
<body>
  <div class="sidebar">
    <a href="./index.html">Inicio</a>
    <a href="./pedidos.html">Pedidos</a>
    <a href="./inventario.html">Inventarios</a>
    <a href="./cliente.html">Cliente</a>
    <a href="./control.html">Ctl. Personal</a>
  </div>

  <div class="main">
    <h2>Control de Personal</h2>

    <!-- üîπ Botones de exportaci√≥n -->
    <div class="export-buttons">
      <button class="export-btn csv-btn" onclick="exportarCSV('tablaControlPersonal')">
        <img src="https://img.icons8.com/color/24/csv.png" alt="CSV"> CSV
      </button>
      <button class="export-btn excel-btn" onclick="exportarExcel('tablaControlPersonal')">
        <img src="https://img.icons8.com/color/24/microsoft-excel-2019--v1.png" alt="Excel"> Excel
      </button>
      <button class="export-btn pdf-btn" onclick="exportarPDF('tablaControlPersonal')">
        <img src="https://img.icons8.com/color/24/pdf.png" alt="PDF"> PDF
      </button>
    </div>

    <!-- Tabla de empleados -->
    <table id="tablaControlPersonal">
      <thead>
        <tr>
          <th>Empleado</th>
          <th>Fecha</th>
          <th>Entrada</th>
          <th>Salida</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr><td>Laura Gomez</td><td>23/02/2025</td><td>8:15</td><td>19:00</td><td></td></tr>
        <tr><td>Javier Torres</td><td>04/03/2025</td><td>7:30</td><td>20:00</td><td></td></tr>
        <tr><td>Miguel √Åvila</td><td>19/03/2025</td><td>8:30</td><td>20:30</td><td></td></tr>
        <tr><td>Mariana L√≥pez</td><td>13/04/2025</td><td>9:00</td><td>21:00</td><td></td></tr>
        <tr><td>Eduardo Quispe</td><td>25/04/2025</td><td>8:00</td><td>21:30</td><td></td></tr>
      </tbody>
    </table>

    <button id="btnRegistrarEmpleado">Registrar Nuevo Empleado</button>

    <form id="controlPersonalForm">
      <div class="form-group">
        <label for="empleado">Empleado:</label>
        <input type="text" id="empleado" placeholder="Nombre del empleado">
      </div>
      <div class="form-group">
        <label for="fecha">Fecha:</label>
        <input type="date" id="fecha">
      </div>
      <div class="form-group">
        <label for="entrada">Entrada (hh:mm):</label>
        <input type="time" id="entrada">
      </div>
      <div class="form-group">
        <label for="salida">Salida (hh:mm):</label>
        <input type="time" id="salida">
      </div>
      <button id="btnAgregarEmpleado" type="button">Registrar Empleado</button>
    </form>
  </div>

  <!-- librer√≠as -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.28/jspdf.plugin.autotable.min.js"></script>

  <script>
    let filaEditando = null;

    // ‚úÖ Formateo sin new Date (evita un d√≠a menos)
    function formatearFecha(fecha) {
      const [anio, mes, dia] = fecha.split("-");
      return `${dia}/${mes}/${anio}`;
    }

    document.getElementById("btnRegistrarEmpleado").addEventListener("click", () => {
      document.getElementById("controlPersonalForm").style.display = "flex";
      document.getElementById("btnAgregarEmpleado").textContent = "Registrar Empleado";
      filaEditando = null;
    });

    document.getElementById("btnAgregarEmpleado").addEventListener("click", () => {
      const empleado = document.getElementById("empleado").value;
      const fecha = document.getElementById("fecha").value;
      const entrada = document.getElementById("entrada").value;
      const salida = document.getElementById("salida").value;

      const fechaRegex = /^\d{4}-\d{2}-\d{2}$/;
      const horaRegex = /^(0?[0-9]|1[0-9]|2[0-3]):([0-5]?[0-9])$/;

      if (!empleado || !fecha || !entrada || !salida) {
        alert("Por favor completa todos los campos.");
      } else if (!fechaRegex.test(fecha)) {
        alert("La fecha debe tener el formato yyyy-mm-dd.");
      } else if (!horaRegex.test(entrada) || !horaRegex.test(salida)) {
        alert("La hora debe tener el formato hh:mm.");
      } else {
        if (filaEditando) {
          filaEditando.cells[0].textContent = empleado;
          filaEditando.cells[1].textContent = formatearFecha(fecha);
          filaEditando.cells[2].textContent = entrada;
          filaEditando.cells[3].textContent = salida;
          filaEditando = null;
        } else {
          const tabla = document.querySelector("#tablaControlPersonal tbody");
          const fila = tabla.insertRow();

          fila.insertCell(0).textContent = empleado;
          fila.insertCell(1).textContent = formatearFecha(fecha);
          fila.insertCell(2).textContent = entrada;
          fila.insertCell(3).textContent = salida;
          const acciones = fila.insertCell(4);
          agregarBotonesAccion(acciones, fila);
        }

        document.getElementById("controlPersonalForm").reset();
        document.getElementById("controlPersonalForm").style.display = "none";
        document.getElementById("btnAgregarEmpleado").textContent = "Registrar Empleado";
      }
    });

    function agregarBotonesAccion(celda, fila) {
      celda.innerHTML = '';

      const btnEditar = document.createElement("button");
      btnEditar.textContent = "Editar";
      btnEditar.className = "accion-btn editar";
      btnEditar.onclick = () => {
        document.getElementById("empleado").value = fila.cells[0].textContent;
        const partesFecha = fila.cells[1].textContent.split("/");
        document.getElementById("fecha").value = `${partesFecha[2]}-${partesFecha[1]}-${partesFecha[0]}`;
        document.getElementById("entrada").value = fila.cells[2].textContent;
        document.getElementById("salida").value = fila.cells[3].textContent;
        document.getElementById("controlPersonalForm").style.display = "flex";
        document.getElementById("btnAgregarEmpleado").textContent = "Guardar cambios";
        filaEditando = fila;
      };

      const btnEliminar = document.createElement("button");
      btnEliminar.textContent = "Eliminar";
      btnEliminar.className = "accion-btn eliminar";
      btnEliminar.onclick = () => {
        if (confirm("¬øEst√°s seguro de eliminar este registro?")) {
          fila.remove();
        }
      };

      celda.appendChild(btnEditar);
      celda.appendChild(btnEliminar);
    }

    document.querySelectorAll("#tablaControlPersonal tbody tr").forEach(fila => {
      agregarBotonesAccion(fila.cells[4], fila);
    });

    // --- Exportar CSV ---
    function exportarCSV(idTabla) {
      const filas = document.querySelectorAll(`#${idTabla} tr`);
      let csv = [];
      filas.forEach(fila => {
        let cols = fila.querySelectorAll("th, td");
        let data = [];
        cols.forEach((c, i) => {
          if (i < cols.length - 1) data.push(c.innerText);
        });
        csv.push(data.join(","));
      });

      let blob = new Blob([csv.join("\n")], { type: "text/csv;charset=utf-8;" });
      let link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = `${idTabla}.csv`;
      link.click();
    }

    // --- Exportar Excel ---
    function exportarExcel(idTabla) {
      let tabla = document.getElementById(idTabla);
      let tablaClon = tabla.cloneNode(true);
      tablaClon.querySelectorAll("tr").forEach(fila => fila.deleteCell(-1));
      let wb = XLSX.utils.table_to_book(tablaClon, { sheet: "Hoja1" });
      XLSX.writeFile(wb, `${idTabla}.xlsx`);
    }

    // --- Exportar PDF ---
    async function exportarPDF(idTabla) {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    doc.setFontSize(16);
    doc.text("Reporte - Control de Personal", 14, 16);

    const fecha = new Date();
    const fechaStr = fecha.toLocaleDateString("es-PE") + " " + fecha.toLocaleTimeString("es-PE");
    doc.setFontSize(12);
    doc.text("Fecha de descarga: " + fechaStr, 14, 22);

    const tabla = document.getElementById(idTabla);
    let body = [];
    tabla.querySelectorAll("tbody tr").forEach(fila => {
        let rowData = [];
        fila.querySelectorAll("td").forEach((celda, i, arr) => {
            if(i < arr.length-1) rowData.push(celda.innerText);
        });
        body.push(rowData);
    });

    let head = [];
    tabla.querySelectorAll("thead tr").forEach(fila => {
        let rowData = [];
        fila.querySelectorAll("th").forEach((celda, i, arr) => {
            if(i < arr.length-1) rowData.push(celda.innerText);
        });
        head.push(rowData);
    });

    doc.autoTable({
        head: head,
        body: body,
        startY: 26,
        theme: 'grid',
        headStyles: { fillColor:[59,130,246], textColor:255 },
        bodyStyles: { textColor:0 },
        styles: { halign:'center', fontSize:10 }
    });

    doc.save("control_personal.pdf");
}
  </script>
</body>
</html>
